// LeadOff CRM - Prisma Schema
// Database: SQLite (Phase 1) - PostgreSQL-ready design

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================================================
// ENUMS (as Strings for SQLite compatibility)
// Note: Validation enforced at application layer via Zod schemas
// For PostgreSQL migration: convert these to native enums
// ============================================================================

// ============================================================================
// MODELS
// ============================================================================

model Lead {
  id                String    @id @default(cuid())

  // Core contact information (required)
  companyName       String
  contactName       String
  phone             String
  email             String

  // Optional contact details
  contactTitle      String?
  companyDescription String?
  leadSource        String @default("EMAIL") // LeadSource enum

  // Sales process tracking
  currentStage      String @default("INQUIRY") // Stage enum
  estimatedValue    Float?

  // Follow-up management
  nextFollowUpDate  DateTime?
  lastActivityDate  DateTime?

  // Next Action tracking
  nextActionType        String?
  nextActionDescription String?
  nextActionDueDate     DateTime?

  // Archive support
  isArchived            Boolean   @default(false)
  archivedAt            DateTime?
  archiveReason         String?

  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relationships
  activities        Activity[]
  organizationInfo  OrganizationInfo?
  demoDetails       DemoDetails?
  proposal          Proposal?
  lostReason        LostReason?
  stageHistory      StageHistory[]

  @@index([companyName])
  @@index([contactName])
  @@index([email])
  @@index([currentStage])
  @@index([nextFollowUpDate])
  @@index([createdAt])
  @@index([nextActionDueDate])
  @@index([isArchived])
}

model Activity {
  id          String       @id @default(cuid())
  leadId      String
  type        String @default("NOTE") // ActivityType enum
  subject     String
  notes       String?
  aiSummary   String?
  completed   Boolean      @default(false)
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relationships
  lead        Lead         @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([dueDate])
  @@index([createdAt])
}

model OrganizationInfo {
  id                String    @id @default(cuid())
  leadId            String    @unique
  employeeCount     Int?
  annualRevenue     Float?
  industry          String?
  decisionMaker     String?
  decisionMakerRole String?
  currentSolution   String?
  painPoints        String?
  budget            Float?
  timeline          String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relationships
  lead              Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)
}

model DemoDetails {
  id                String       @id @default(cuid())
  leadId            String       @unique
  demoDate          DateTime
  demoType          String @default("ONLINE") // DemoType enum
  attendees         String?
  demoOutcome       String? // DemoOutcome enum
  userCountEstimate Int?
  followUpRequired  Boolean      @default(false)
  notes             String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  // Relationships
  lead              Lead         @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([demoDate])
}

model Proposal {
  id              String         @id @default(cuid())
  leadId          String         @unique
  proposalDate    DateTime
  estimatedValue  Float
  products        String?
  contractTerm    String?
  status          String @default("DRAFT") // ProposalStatus enum
  notes           String?
  proposalFilePath    String?
  priceSheetPath      String?
  proposalFileName    String?
  priceSheetFileName  String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  // Relationships
  lead            Lead           @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([proposalDate])
  @@index([status])
}

model LostReason {
  id             String             @id @default(cuid())
  leadId         String             @unique
  reason         String // LostReasonCategory enum
  competitorName String?
  lostDate       DateTime
  notes          String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  // Relationships
  lead           Lead               @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([lostDate])
  @@index([reason])
}

model StageHistory {
  id          String   @id @default(cuid())
  leadId      String
  fromStage   String? // Stage enum
  toStage     String // Stage enum
  changedAt   DateTime @default(now())
  note        String?

  // Relationships
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([changedAt])
}

model Template {
  id          String   @id @default(cuid())
  type        String   // EMAIL, PHONE_CALL, TEXT_MESSAGE
  name        String
  subject     String?
  body        String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([type])
  @@index([isActive])
}
